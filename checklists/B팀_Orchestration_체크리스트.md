# 🅱️ B팀 (Orchestration) 완전 체크리스트

## 🎭 핵심 이슈 체크리스트 (Week-1)

### B-O1: `/agents/from-category` 매니페스트 빌더
**목표**: 노드 경로 입력 → AgentManifest 생성 (필터 canonical 강제)

**필수 구현 사항**:
- [ ] FromCategoryRequest 입력 검증 (version, node_paths, options)
- [ ] AgentManifest 출력 생성 (common-schemas 준수)
- [ ] `allowed_category_paths` 필수 필드 채움
- [ ] `retrieval.filter.canonical_in: true` 강제 설정
- [ ] 기본 retrieval 설정: `bm25_topk=12, vector_topk=12, rerank 50→5`
- [ ] 기본 features 설정: `debate=false, hitl_below_conf=0.70, cost_guard=true`
- [ ] 선택적 `mcp_tools_allowlist` 처리

**품질 검증**:
- [ ] contract-test 통과 (`packages/common-schemas/tests/contract_test.py`)
- [ ] 잘못된 입력에 대한 422 Validation Error 반환
- [ ] 생성된 매니페스트 JSON 스키마 검증
- [ ] 필수 키 누락 시 에러 처리
- [ ] API 응답 시간 ≤500ms

### B-O2: Retriever 스코프 제한 필터
**목표**: allowed_category_paths 기반 retrieval 필터 (범위 외 접근 차단)

**필터링 로직 구현**:
- [ ] `canonical_path` 기반 필터링 로직 구현
- [ ] 허용된 경로 하위 카테고리만 검색 허용
- [ ] 범위 외 문서 접근 시 0건 반환 확인
- [ ] 필터 적용 전/후 결과 수 로깅
- [ ] SQL WHERE 절 또는 벡터 DB 필터 쿼리 구현
- [ ] 필터 우회 시도 탐지 및 차단

**보안 및 검증**:
- [ ] 권한 우회 시도 테스트 (unauthorized access)
- [ ] 필터 무효화 공격 방어 (SQL injection style)
- [ ] 로그에 필터 적용 경로 기록
- [ ] 감사 로그: 누가/언제/어떤 범위로 접근했는지
- [ ] 성능 영향 최소화 (인덱스 활용)

### B-O3: 7-Step 파이프라인 골격 + 근거/버전 표기
**목표**: intent→retrieve→plan→(tools/debate)→compose→cite→respond 완전 구현

**LangGraph 파이프라인 구현**:
- [ ] Step 1: Intent Classification (사용자 의도 파악)
- [ ] Step 2: Retrieve (하이브리드 검색, 필터 적용)
- [ ] Step 3: Plan (답변 전략 계획)
- [ ] Step 4: Tools/Debate (필요시 도구 사용, debate 스위치)
- [ ] Step 5: Compose (답변 구성)
- [ ] Step 6: Cite (출처 인용 ≥2개)
- [ ] Step 7: Respond (최종 응답 생성)

**필수 메타데이터 포함**:
- [ ] 응답에 출처 ≥2개 포함 (URL, title, date)
- [ ] `taxonomy_version` 표기
- [ ] `confidence` 점수 표기
- [ ] `cost` 계산 (토큰 사용량 기반)
- [ ] `latency` 측정 (파이프라인 전체 시간)
- [ ] debate 스위치 로직 (불확실 태그 시 활성화)

**파이프라인 품질 검증**:
- [ ] 샘플 30건 E2E 테스트 성공
- [ ] 각 단계별 실행 시간 로깅
- [ ] 실패 단계 식별 및 재시도 로직
- [ ] 메모리 사용량 모니터링
- [ ] 병렬 처리 가능 구간 최적화

### B-O4: CBR 조회/로그 수집 (Neural Selector 데이터)
**목표**: CaseBank read-only 조회 + 유사도 로그/성과 레이블 적재

**CBR 시스템 기초 구현**:
- [ ] `/cbr/suggest` k-NN 조회 엔드포인트
- [ ] 케이스 유사도 계산 (코사인 유사도/유클리드 거리)
- [ ] 상위 k개 케이스 추천 (기본 k=5)
- [ ] 케이스 메타데이터 포함 (category_path, quality_score)
- [ ] 빠른 조회를 위한 벡터 인덱스 활용

**데이터 수집 및 로깅**:
- [ ] 로그 필드 정의: query, category_path, picked_case_ids, success_flag
- [ ] 사용자 피드백 수집 (thumbs up/down)
- [ ] 케이스 선택 빈도 추적
- [ ] A/B 테스트 준비 (케이스 추천 전략 비교)
- [ ] Neural Selector 학습용 데이터 축적

## 🎛️ B팀 전문 영역 심화 체크리스트

### 🔀 워크플로우 오케스트레이션
**워크플로우 엔진**:
- [ ] 워크플로우 정의 DSL 설계 (YAML/JSON 기반)
- [ ] 동적 워크플로우 생성 및 수정 기능
- [ ] 워크플로우 버전 관리 (v1.0, v1.1, ...)
- [ ] 단계별 실행 상태 추적 (pending, running, completed, failed)
- [ ] 조건부 분기 처리 (if-then-else 로직)
- [ ] 루프 처리 (while, for-each)
- [ ] 병렬 실행 지원 (parallel tasks)

**실행 엔진**:
- [ ] 비동기 작업 큐 (Celery/RQ) 통합
- [ ] 실행 컨텍스트 관리 (변수, 상태 전달)
- [ ] 실패 시 재시도 정책 (exponential backoff)
- [ ] 실행 시간 제한 (timeout) 설정
- [ ] 리소스 사용량 제한 (CPU, 메모리)
- [ ] 실행 우선순위 관리

### 🔗 서비스 통합 및 연동
**내부 서비스 통합**:
- [ ] A팀 분류 서비스 HTTP 클라이언트 구현
- [ ] C팀 알림 서비스 연동
- [ ] 서비스 디스커버리 (Consul/etcd) 준비
- [ ] 헬스체크 및 서킷 브레이커 패턴
- [ ] 로드 밸런싱 (라운드로빈, 가중치 기반)

**외부 API 통합**:
- [ ] OpenAI/Anthropic API 클라이언트
- [ ] 외부 검색 엔진 연동 (Elasticsearch)
- [ ] 메시지 큐잉 (Redis Pub/Sub, RabbitMQ)
- [ ] 캐싱 계층 (Redis) 통합
- [ ] 모니터링 서비스 (Prometheus, Grafana) 연동

### 📊 상태 관리 및 지속성
**분산 상태 저장소**:
- [ ] Redis Cluster 설정 및 관리
- [ ] 상태 직렬화/역직렬화 (JSON, Pickle)
- [ ] 세션 관리 (사용자별 컨텍스트 유지)
- [ ] 상태 TTL 관리 (만료 처리)
- [ ] 분산 락 구현 (동시성 제어)

**데이터 일관성**:
- [ ] 트랜잭션 경계 정의
- [ ] 보상 트랜잭션 (Saga 패턴) 구현
- [ ] 이벤트 소싱 준비
- [ ] CQRS (Command Query Responsibility Segregation) 검토
- [ ] 최종 일관성 (Eventual Consistency) 보장

### 🚀 성능 최적화 및 모니터링
**성능 최적화**:
- [ ] 응답 시간 프로파일링 (각 단계별)
- [ ] 병목점 식별 및 개선
- [ ] 캐싱 전략 구현 (L1: 메모리, L2: Redis)
- [ ] 비동기 처리 최대화
- [ ] 커넥션 풀 최적화 (DB, HTTP)

**모니터링 및 관측성**:
- [ ] 메트릭 수집 (Prometheus/Grafana)
- [ ] 분산 추적 (Jaeger/Zipkin) 구현
- [ ] 구조화된 로깅 (JSON 형태)
- [ ] 알림 시스템 (Slack/Email/PagerDuty)
- [ ] 대시보드 구축 (실시간 상태 모니터링)

**용량 계획 및 스케일링**:
- [ ] 자동 스케일링 정책 (CPU/메모리 기반)
- [ ] 수평적 확장 설계
- [ ] 로드 테스트 시나리오 구축
- [ ] 용량 예측 모델링
- [ ] 비용 최적화 전략

## ⚡ B팀 성능 목표 달성 체크리스트

### 📈 오케스트레이션 성능 KPI
**응답 시간 목표**:
- [ ] 7-Step 파이프라인 전체 실행 시간 ≤3s
- [ ] 개별 단계 실행 시간: intent(100ms), retrieve(800ms), plan(200ms), compose(500ms)
- [ ] CBR 조회 응답 시간 ≤200ms
- [ ] Agent manifest 생성 시간 ≤100ms
- [ ] 서비스 간 통신 지연 시간 ≤50ms

**처리량 및 동시성**:
- [ ] 동시 워크플로우 100개 처리
- [ ] 동시 사용자 500명 지원
- [ ] 메시지 큐 처리율 1000 msg/sec
- [ ] 캐시 히트율 ≥80%
- [ ] 커넥션 풀 활용률 ≥70%

**가용성 및 안정성**:
- [ ] 시스템 가용성 ≥99.5% (Week-1 기준)
- [ ] 평균 장애 복구 시간 (MTTR) ≤15분
- [ ] 무정지 배포 (Blue-Green) 준비
- [ ] 자동 장애 감지 및 알림 ≤30초
- [ ] 데이터 손실 0건 (상태 백업/복구)

### 💰 비용 효율성
**리소스 최적화**:
- [ ] 오케스트레이션 요청당 비용 ≤₩5
- [ ] CPU 사용률 최적화 (평균 ≤60%, 피크 ≤90%)
- [ ] 메모리 사용률 최적화 (평균 ≤70%, 피크 ≤85%)
- [ ] 네트워크 대역폭 최적화
- [ ] 스토리지 비용 최적화 (압축, 아카이빙)

## 🔒 B팀 보안 및 컴플라이언스

### 🛡️ 보안 구현
**인증 및 권한**:
- [ ] JWT 기반 인증 구현
- [ ] 역할 기반 접근 제어 (RBAC)
- [ ] API 키 관리 및 로테이션
- [ ] 서비스 간 mTLS 통신
- [ ] OAuth2/OIDC 통합 준비

**데이터 보안**:
- [ ] 전송 중 암호화 (TLS 1.3)
- [ ] 저장 시 암호화 (AES-256)
- [ ] 민감 정보 마스킹 (로그, 메트릭)
- [ ] 비밀 관리 (Vault, K8s Secrets)
- [ ] 감사 로그 무결성 보장

**API 보안**:
- [ ] API 요청 제한 (Rate Limiting)
- [ ] 입력 검증 및 Sanitization
- [ ] CORS 정책 설정
- [ ] API 버전 관리 및 deprecation
- [ ] 보안 헤더 설정

### 📋 컴플라이언스
**데이터 보호**:
- [ ] 개인정보 처리 방침 준수
- [ ] 데이터 최소화 원칙 적용
- [ ] 동의 관리 시스템 연동
- [ ] 데이터 보존 기간 관리
- [ ] Right to be Forgotten (R2BF) 지원

**감사 및 추적**:
- [ ] 모든 API 호출 로깅
- [ ] 사용자 행동 추적
- [ ] 시스템 변경 이력 관리
- [ ] 보안 이벤트 모니터링
- [ ] 컴플라이언스 리포트 생성

## 🧪 B팀 테스트 전략

### 단위 테스트
**오케스트레이션 로직**:
- [ ] 워크플로우 실행 엔진 테스트
- [ ] 단계별 실행 로직 테스트
- [ ] 상태 관리 로직 테스트
- [ ] 에러 처리 및 재시도 로직 테스트
- [ ] 비즈니스 로직 테스트 (커버리지 ≥90%)

### 통합 테스트
**서비스 연동**:
- [ ] A팀 분류 서비스 연동 테스트
- [ ] C팀 UI 서비스 연동 테스트
- [ ] 외부 API 연동 테스트 (Mock/Stub)
- [ ] 메시지 큐 연동 테스트
- [ ] 데이터베이스 연동 테스트

### 성능 테스트
**부하 및 스트레스 테스트**:
- [ ] 로드 테스트 (500 concurrent users)
- [ ] 스트레스 테스트 (시스템 한계 측정)
- [ ] 볼륨 테스트 (대량 데이터 처리)
- [ ] 스파이크 테스트 (순간 부하 급증)
- [ ] 내구성 테스트 (48시간 연속 운영)

### 시큐리티 테스트
**보안 검증**:
- [ ] 인증 우회 테스트
- [ ] 권한 상승 테스트
- [ ] 입력 검증 우회 테스트
- [ ] 세션 하이재킹 테스트
- [ ] API 보안 테스트 (OWASP Top 10)

## 🚨 B팀 위험 관리

### 기술적 위험
**시스템 위험**:
- [ ] 단일 장애점(SPOF) 제거
- [ ] 캐스케이딩 실패 방지 (Circuit Breaker)
- [ ] 메모리 누수 모니터링
- [ ] 데드락 탐지 및 해결
- [ ] 리소스 고갈 방지 (Connection Pool, Memory)

**성능 위험**:
- [ ] 응답 시간 SLA 위반 대비
- [ ] 처리량 한계 도달 대비
- [ ] 메모리/CPU 사용률 급증 대비
- [ ] 네트워크 지연 증가 대비
- [ ] 캐시 무효화로 인한 성능 저하 대비

### 운영적 위험
**서비스 의존성**:
- [ ] A팀 서비스 장애 시 대응 방안
- [ ] C팀 서비스 변경 시 영향 분석
- [ ] 외부 API 장애 시 fallback 전략
- [ ] 메시지 큐 장애 시 데이터 손실 방지
- [ ] 데이터베이스 장애 시 읽기 전용 모드

**배포 및 변경 위험**:
- [ ] 무정지 배포 전략 (Blue-Green, Canary)
- [ ] 롤백 계획 및 자동화
- [ ] 구성 변경 관리
- [ ] 데이터베이스 스키마 마이그레이션 위험
- [ ] 의존성 업데이트 영향 분석

## ✅ B팀 Week-1 완료 검증

### 핵심 기능 동작 검증
- [ ] `/agents/from-category` API 정상 동작 (200 OK 응답)
- [ ] `/chat/run` 7-Step 파이프라인 기본 실행 성공
- [ ] `/search` 하이브리드 검색 정상 동작
- [ ] `/cbr/suggest` CBR 조회 정상 동작
- [ ] 헬스체크 엔드포인트 정상 응답

### A팀-C팀 연동 검증
- [ ] A팀 분류 서비스 호출 성공
- [ ] A팀에서 받은 분류 결과를 C팀으로 전달 성공
- [ ] C팀 UI에서 B팀 API 호출 성공
- [ ] 에러 발생 시 적절한 에러 응답 반환
- [ ] API 계약 (common-schemas) 준수 확인

### 품질 기준 달성
- [ ] 오케스트레이션 지연 시간 ≤2s (Week-1 기준)
- [ ] 동시 처리 ≥50 requests (Week-1 기준)
- [ ] 요청당 비용 ≤₩10 (Week-1 기준)
- [ ] 시스템 가용성 ≥99% (Week-1 기준)
- [ ] 치명적 버그 0건

### 통합 시나리오 검증
- [ ] 사용자 질의 → 의도 파악 → 분류 요청 → 검색 → 응답 생성 전체 플로우
- [ ] 에이전트 생성 → 카테고리 제한 → 필터링된 검색 결과 확인
- [ ] CBR 케이스 추천 → 사용자 선택 → 피드백 수집 플로우
- [ ] 에러 발생 시 적절한 fallback 동작 확인
- [ ] 로그 수집 및 메트릭 집계 동작 확인

### 문서화 완료
- [ ] API 문서 (OpenAPI) 작성 완료
- [ ] 워크플로우 설계 문서 작성
- [ ] 서비스 연동 가이드 작성
- [ ] 모니터링 설정 가이드 작성
- [ ] 장애 대응 매뉴얼 초안 작성

---
**담당자**: @devB  
**마지막 업데이트**: 2025-09-02  
**체크리스트 버전**: v1.0  
**Week-1 목표**: 2025-09-09 18:00 (KST)