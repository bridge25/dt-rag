# dt-rag 문서 동기화 계획 (2025-10-24)

## 1. 현황 분석

### 1.1 프로젝트 상태 스냅샷

| 항목 | 현황 | 평가 |
|------|------|------|
| **프로젝트 모드** | Personal (자율 개발) | ✓ 적절 |
| **SPEC 정의 수** | 35개 | ✓ 충분 |
| **완전한 TAG 체인** | 5개 (14.3%) | 🔴 매우 낮음 |
| **불완전한 체인** | 22개 (62.9%) | 🟡 주의 필요 |
| **고아 TAG** | 14개 (40%) | 🔴 심각 |
| **TAG 품질 점수** | 65/100 (C등급) | 🟡 개선 필요 |
| **SPEC-CODE 커버리지** | 17% | 🔴 매우 낮음 |
| **TEST 커버리지** | 71% SPEC이 테스트 없음 | 🔴 높은 위험 |
| **문서화율** | 5.7% | 🔴 심각한 부족 |

### 1.2 최근 코드 변경

```
최신 커밋 (8111793): "docs: Update repository redirection document"
변경 파일:
  - README.md (마이그레이션 공지)
  - .moai/config.json (구성 변경)
  - 캐시 파일 (__pycache__ 등)

미커밋 변경사항 존재
```

### 1.3 현재 프로젝트 구조

```
dt-rag/
├── apps/
│   ├── api/             (핵심 API 라우터)
│   ├── orchestration/   (오케스트레이션 엔진)
│   ├── classification/  (분류 시스템)
│   ├── evaluation/      (평가 시스템)
│   └── frontend/        (프론트엔드)
├── tests/
│   ├── unit/            (36개 테스트)
│   ├── integration/     (13개 테스트)
│   ├── performance/     (3개 벤치마크)
│   └── e2e/             (2개 E2E 테스트)
├── docs/                (문서)
├── migrations/          (DB 마이그레이션)
└── .moai/               (MoAI 프레임워크)
    ├── specs/           (35개 SPEC)
    ├── reports/         (동기화 리포트)
    ├── project/         (프로젝트 문서)
    └── memory/          (개발 가이드)
```

### 1.4 TAG 시스템 현황 상세

**SPEC TAG 분포:**
```
완전 체인 (SPEC+TEST+CODE+DOC):  5개  (14.3%) ✓ FOUNDATION, TEST-001/002/003, CICD
불완전 체인 (2-3개만):          22개  (62.9%) ⚠ 핵심 기능들
SPEC만 존재:                    8개  (22.9%) 🔴 고아
```

**고아 TAG 목록 (14개):**
- SPEC-API-001, CLASS-001, DATABASE-001, SEARCH-001
- SECURITY-001, ORCHESTRATION-001, SCHEMA-SYNC-001
- ENV-VALIDATE-001, JOB-OPTIMIZE-001
- INGESTION-001, SOFTQ-001, IMPORT-ASYNC-FIX-001
- ROUTER-IMPORT-FIX-001, UI-DESIGN-001

---

## 2. 동기화 범위 결정 (CODE-FIRST)

### 2.1 실행 가능한 범위 (Phase 1)

**우선순위 1 - 고아 TAG 정리:**
```
대상: SPEC 존재 but CODE/TEST 부재인 14개
전략: Living Document에 상태 기록 + 향후 계획 명시
예상 시간: 2시간
```

**우선순위 2 - 기존 완전 체인 동기화:**
```
대상: 5개 완전 체인 (FOUNDATION, TEST-001/002/003, CICD-001)
작업:
  1. 각 SPEC 파일의 최신 상태 확인
  2. README.md에 완전 체인 목록 추가
  3. CHANGELOG.md 업데이트
  4. TAG 트레이스 매트릭스 재생성
예상 시간: 3시간
```

**우선순위 3 - 불완전 체인 보강:**
```
대상: 22개 불완전 체인 중 실제 구현된 것
작업:
  1. @CODE 태그 스캔으로 실제 구현 범위 확인
  2. 필요한 @TEST 태그 추가
  3. 불일치 항목 문서화
예상 시간: 4-5시간
```

**우선순위 4 - 문서 일관성 정리:**
```
대상: 구조.md, 기술.md 및 API 문서
작업:
  1. 현재 아키텍처와 문서 대조
  2. 사라진 모듈 제거
  3. 새로운 모듈 추가
예상 시간: 2-3시간
```

### 2.2 제약사항 및 위험 요소

| 제약 | 설명 | 영향 | 대응 |
|------|------|------|------|
| **마이그레이션 상황** | 프로젝트가 새 저장소로 이전됨 | Git 히스토리 분리 | 새 저장소 기준으로 동기화 |
| **고아 SPEC** | 14개 SPEC이 구현 없음 | 추적성 붕괴 | 상태 명시 + 향후 계획 기록 |
| **테스트 부족** | 71% SPEC이 테스트 미작성 | 품질 보증 불가 | 기존 테스트만 추적 |
| **문서 단절** | 문서와 코드 불일치 | 유지보수 어려움 | 현재 코드 기준으로 동기화 |

### 2.3 TRUST 원칙 준수 상황

```
T (Test First)   : 36개 테스트 존재, 71%의 SPEC은 테스트 미커버 ⚠
R (Readable)     : 코드베이스 정상적으로 읽을 수 있음 ✓
U (Unified)      : 타입 안전성 대부분 준수됨 ✓
S (Secured)      : 기본 보안 원칙 적용됨 ✓
T (Trackable)    : TAG 시스템 적용되나 고아 SPEC 다수 🔴
```

---

## 3. Living Document 업데이트 전략

### 3.1 문서 우선순위

**1단계: 핵심 문서 (1시간)**
```
파일: .moai/project/product.md
상태: v0.1.3 (활성)
수정:
  - Mission 섹션: 12개 에이전트 구성 확인
  - Success Criteria: 현재 달성율 반영
  - Legacy: 마이그레이션 정보 추가
```

**2단계: 구조 및 기술 문서 (1.5시간)**
```
파일: .moai/project/structure.md, tech.md
수정:
  - 현재 아키텍처 다이어그램 업데이트
  - 모듈 책임 명확화 (7개 핵심 모듈)
  - 기술 스택 최신화
```

**3단계: README.md (2시간)**
```
섹션:
  1. 프로젝트 개요 (마이그레이션 공지)
  2. 빠른 시작 가이드
  3. 아키텍처 개요 (apps/, migrations/ 구조)
  4. TAG 추적성 요약 (5개 완전 체인)
  5. 개발 워크플로우 (SPEC → TEST → CODE → SYNC)
  6. 문제해결 가이드
```

**4단계: 아키텍처 다이어그램**
```
추가할 요소:
  - API 계층: embedding_router, consolidation_router, reflection_router
  - 오케스트레이션: meta_planner, debate_engine, reflection_engine
  - 분류: semantic_classifier, hybrid_classifier
  - 데이터: casebank, vector embeddings (1536d)
```

### 3.2 CHANGELOG.md 업데이트 전략

**형식:**
```markdown
## [X.Y.Z] - YYYY-MM-DD

### Added
- [새로운 기능/모듈]
- @CODE:SPEC-ID로 추적

### Changed
- [변경된 기능]
- 이전 TAG → 새 TAG 매핑

### Fixed
- [버그 수정]
- 관련 TAG 참조

### Security
- [보안 관련 변경]
```

**작성 우선순위:**
1. 최신 5개 SPEC (FOUNDATION-001, TEST-001/002/003, CICD-001) 기록
2. 각 섹션별 TAG 참조 명시
3. 마이그레이션 관련 변경사항 기록

### 3.3 API 문서 생성

**생성 대상:**
```
apps/api/routers/
  - embedding_router.py    @CODE:EMBED-001
  - reflection_router.py   @CODE:REFLECTION-001
  - consolidation_router.py @CODE:CONSOLIDATION-001
  - classify.py            @CODE:CLASS-001
  - health.py              @CODE:HEALTH-001
```

**문서 형식: OpenAPI 3.0**
```yaml
/api/embed:
  post:
    summary: "임베딩 생성"
    tags: ["@CODE:EMBED-001"]

/api/reflect:
  post:
    summary: "반영 엔진"
    tags: ["@CODE:REFLECTION-001"]
```

---

## 4. TAG 인덱스 및 추적성 매트릭스

### 4.1 TAG 인덱스 재구성

**파일:** `.moai/reports/tag-traceability-index-2025-10-24.md`

**구조:**
```
1. TAG 시스템 개요
   ├─ Primary Chain (SPEC → CODE → TEST)
   ├─ Quality Chain (DOC, PERF, SEC)
   └─ 무결성 기준

2. SPEC별 TAG 매핑 (35개)
   ├─ 완전 체인 (5개) ✓
   ├─ 불완전 체인 (22개) ⚠
   └─ 고아 SPEC (8개) 🔴

3. 고아 TAG 정리
   ├─ 상태: "미구현" 명시
   ├─ 이유: 요구사항 변경/지연/폐기
   └─ 향후 계획: 일정/우선순위

4. 현황 통계
   ├─ 총 TAG: 95개
   ├─ 완전성: 14.3%
   ├─ 적절성: 62.9%
   └─ 위험도: 22.9% (고아)
```

### 4.2 추적성 매트릭스

**형식: 3차원 추적 테이블**

```markdown
| SPEC ID | 상태 | CODE 적용 | TEST 커버 | 문서화 | 피고 |
|---------|------|---------|---------|-------|------|
| FOUNDATION-001 | ✓ | ✓ | ✓ | ✓ | 완전 |
| TEST-001 | ✓ | ✓ | ✓ | ✓ | 완전 |
| EMBED-001 | ✓ | ✓ | ⚠ | ✗ | 불완전 |
| CLASS-001 | ✓ | ✗ | ✗ | ✗ | 고아 |
```

**고아 분류:**
- 🔴 **Type A (SPEC만)**: 14개 - 미분석 또는 폐기된 요구사항
- 🟡 **Type B (CODE만)**: 미존재 - 모든 구현이 SPEC 추적
- 🟠 **Type C (TEST만)**: 미존재 - 모든 테스트가 SPEC 추적

### 4.3 TAG 무결성 검증 스크립트

**실행:**
```bash
# SPEC 스캔
rg '@SPEC:' .moai/specs/ -n

# CODE 스캔
rg '@CODE:' apps/ -n

# TEST 스캔
rg '@TEST:' tests/ -n

# 고아 검출
rg '@SPEC:(\w+-\d{3})' .moai/specs/ -o | while read tag; do
  rg "$tag" apps/ tests/ docs/ > /dev/null || echo "고아: $tag"
done
```

---

## 5. 동기화 실행 계획

### 5.1 3단계 동기화 프로세스

**Phase 1: 상태 분석 (30분)**
```
✓ 현재 TAG 상태 스캔
✓ 고아 SPEC 목록화
✓ 불완전 체인 식별
✓ 마이그레이션 영향 분석
```
예상 시간: 0.5시간

**Phase 2: Living Document 업데이트 (9시간)**
```
1. product.md 동기화 (1시간)
   - Mission: 12개 에이전트 확인
   - Success: 현재 달성 상황 반영

2. structure.md & tech.md (1.5시간)
   - 아키텍처 다이어그램 갱신
   - 7개 핵심 모듈 명시
   - 기술 스택 업데이트

3. README.md 완전 재작성 (2시간)
   - 마이그레이션 공지 통합
   - 빠른 시작 가이드 추가
   - TAG 추적성 요약

4. API 문서 자동 생성 (2시간)
   - 5개 라우터 문서화
   - OpenAPI spec 작성

5. CHANGELOG.md 작성 (1.5시간)
   - 최근 5개 SPEC 기록
   - TAG 참조 명시
   - 마이그레이션 정보

6. TAG 인덱스 재구성 (1시간)
   - tag-traceability-index 갱신
   - 추적성 매트릭스 작성
   - 고아 TAG 분류
```

**Phase 3: 검증 및 최종화 (1시간)**
```
✓ 문서 일관성 검증
✓ TAG 참조 정확성 확인
✓ 링크 및 이미지 검증
✓ 마크다운 형식 정리
```

### 5.2 타임라인

```
| 단계 | 작업 | 예상 시간 | 상태 |
|------|------|---------|------|
| 분석 | TAG 스캔 및 현황 파악 | 0.5h | 진행 중 |
| 동기화-1 | product.md, structure.md 업데이트 | 2.5h | 대기 |
| 동기화-2 | README.md, API 문서 작성 | 4h | 대기 |
| 동기화-3 | CHANGELOG, TAG 인덱스 | 2.5h | 대기 |
| 검증 | 최종 검증 및 정리 | 1h | 대기 |
---
총 소요 시간: 약 10.5시간
```

---

## 6. 위험 요소 및 대응 방안

### 6.1 주요 위험 요소

| 위험 | 확률 | 영향 | 심각도 | 대응 |
|------|------|------|-------|------|
| **고아 SPEC 처리 실패** | 높음 | 추적성 붕괴 | 🔴 높음 | 명확한 상태 표시 + 향후 계획 기록 |
| **코드-문서 불일치** | 높음 | 유지보수 어려움 | 🔴 높음 | 현재 코드 기준으로 동기화 |
| **마이그레이션 영향** | 중간 | Git 히스토리 혼란 | 🟡 중간 | 새 저장소 기준으로만 작업 |
| **문서 과도한 수정** | 중간 | 리뷰 시간 증가 | 🟡 중간 | 핵심 문서만 우선 작업 |
| **TAG 중복 생성** | 낮음 | 혼동 증가 | 🟠 낮음 | 스캔 후 기존 TAG 재사용 |

### 6.2 대응 전략

**고아 SPEC 처리:**
```
1. 상태 명시: "미구현 / 기획 중 / 폐기됨" 중 하나 기록
2. 이유 설명: 언제 왜 미구현인지 기록
3. 향후 계획: 언제 구현할지 또는 폐기할지 명시
4. 예시:
   @SPEC:API-001
   상태: 미구현 (기획 중)
   이유: 우선순위 조정 (2025-10-XX)
   계획: Q1 2025에 구현 예정
```

**코드-문서 불일치:**
```
1. 현재 코드 기준으로 문서 작성
2. 문서와 코드 차이 별도 섹션 기록
3. 향후 조화 계획 수립
4. 예시:
   ### 기술 스채: 현재 vs 계획
   - 현재: FastAPI + SQLAlchemy + ChromaDB
   - 계획 중: OpenAI 모델 교체 (GPT-4o)
```

**마이그레이션 영향 최소화:**
```
1. 이 프로젝트 (Unmanned/dt-rag)는 현황 동기화만 수행
2. 새 저장소(bridge25/dt-rag)는 별도 추적
3. 문서에 명확히 "현재 위치: Unmanned/dt-rag (아카이브)"로 표시
```

---

## 7. 성공 기준

### 7.1 완료 조건

```
✓ Living Document 정합성: 90% 이상
✓ TAG 추적성: 최소 5개 완전 체인 유지 + 고아 명시
✓ 문서 최신화: 3개 핵심 문서 (product, structure, README) 갱신
✓ API 문서: 5개 라우터 기본 문서화
✓ 고아 처리: 14개 SPEC 상태 명시 (구현 안 함, 상태만 기록)
```

### 7.2 품질 메트릭

| 지표 | 목표 | 측정 방법 |
|------|------|---------|
| **문서 완성도** | 80% | 섹션별 완성 체크리스트 |
| **TAG 정확성** | 100% | 스캔 결과 검증 |
| **링크 유효성** | 100% | 자동 링크 검증 |
| **마크다운 정합성** | 100% | Markdown linter |

---

## 8. 다음 단계

### 8.1 즉시 (Phase 1)

```
1. 이 보고서 검토 및 승인
2. TAG 스캔 정확성 재확인
3. 고아 SPEC 16개에 대한 상태 결정 (구현/폐기/보류)
```

### 8.2 단기 (Phase 2)

```
1. Living Document 동기화 시작
2. 각 단계별 진행상황 추적
3. 발견되는 불일치 사항 기록
```

### 8.3 중기 (Phase 3)

```
1. 불완전 체인(22개) 보강 계획 수립
2. 테스트 커버리지 개선 로드맵 작성
3. 다음 SPEC 작성 시 TAG 시스템 강화
```

---

## 9. 리소스 및 도구

### 9.1 사용할 도구

```bash
# TAG 스캔
rg '@(SPEC|CODE|TEST|DOC):' -n --type py --type md

# 문서 검증
markdown-lint docs/ .moai/project/

# 링크 검증
find docs/ -name "*.md" -exec grep -l "\[.*\]" {} \;

# 통계
wc -l .moai/project/*.md
```

### 9.2 참고 문서

- `.moai/memory/development-guide.md` - 개발 가이드
- `dt-rag/CLAUDE.md` - MoAI-ADK 사용 지침
- `.moai/project/product.md` - 프로젝트 미션
- `.moai/specs/SPEC-*/spec.md` - 35개 SPEC 정의

---

## 10. 요약

### 현황
- **35개 SPEC** 정의되었으나 **14.3%만 완전 체인**
- **71% SPEC이 테스트 미작성** → 품질 보장 어려움
- **문서화율 5.7%** → 심각한 부족
- **마이그레이션 중** → 새 저장소로 이전 진행 중

### 목표
1. **Living Document 정합성 90% 달성**
2. **TAG 추적성 체계 정리** (완전/불완전/고아 분류)
3. **고아 SPEC 16개 상태 명시** (구현 안 함, 상태만 기록)
4. **README 및 API 문서 작성**

### 계획
- **총 소요 시간:** 약 10.5시간
- **3단계 접근법:** 분석(0.5h) → 동기화(9h) → 검증(1h)
- **우선순위:** 고아 TAG 정리 → 완전 체인 동기화 → 불완전 체인 보강

### 다음 조치
1. ✓ 이 계획 검토 및 승인
2. ⏳ TAG 스캔 정확성 재확인
3. ⏳ Living Document 동기화 시작

---

**작성자**: doc-syncer (Haiku)
**작성일**: 2025-10-24
**버전**: 1.0
**상태**: 초안 → 검토 대기
